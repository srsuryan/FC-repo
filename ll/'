#include <stdio.h>
#include "ll.h"
#include "util.h"

int
check_loop (sll *n, sll *start)
{
    int count = 0;

    while (start) {
        if (start != n) {
            count++;
        } else {
            return count;
        }
        start = start->next;
    }

    return count;
}

int
check_loop2 (sll *start, int inc, sll *n)
{
    int c = 1;
    
    while (start != n) {
        start = start->next;
        c++;
    }

    if (start == n) {
        return !(c == inc);
    }

    return c;
}

int 
main (int argc, char *argv[])
{
    sll *p, *prev, *s, *start;
    int *a, rc, pc = -1;

    a = get_from_main(argc, argv);
    p = create_list(a);

    s = p;
    start = s;
    while (s) {
        prev = s;
        s = s->next;
    }

    s = p;
    //s = s->next;
    //s = s->next;
    //prev->next = s;
#if 0    
    p = start;
    while (p) {
        rc = check_loop(p->next, start);
        if (rc < pc) {
            printf(" loop at %d\n", p->i);
            return 1;
        } else {
            pc = rc;
        }
        p = p->next;
    }
#endif

    c = 1;
    n = start->next;
    if (start == n) {
        loop = TRUE;
        gotto end;
    }

    while (n) {
        c++;
        loop = check_loop2(start, c);
        if (loop) break;
        n = n->next
    }

end:
    printf(" loop %s\n", loop ? "detected" : " not detected");
    return 0;
}
